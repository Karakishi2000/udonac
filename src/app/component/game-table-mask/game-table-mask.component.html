<div class="component is-3d" [ngClass]="{'is-grab': !isLock && !isScratching, 'is-scratching': isScratching && gameTableMask.isMine, 'is-border': !isLock || isScratching }" style="pointer-events: none"
  [style.width.px]="width * gridSize" [style.height.px]="height * gridSize"
  appMovable [movable.option]="movableOption" [movable.disable]="isLock || isScratching" (movable.ondragstart)="onMove()" (movable.ondragend)="onMoved()">
  <div *ngIf="!isScratching" class="is-3d text" style="left: 2px; top: 2px; backface-visibility: hidden" [ngClass]="{fall: altitude == 0}"
    [style.width.px]="width * gridSize - 4" [style.height.px]="height * gridSize - 4"
    [ngStyle]="{'transform': 'translateZ(' + (altitude * gridSize) + 'px)'}">
    <div class="is-3d" [ngClass]="{'is-inverse': isInverse}" [style.font-size.px]="fontSize + 9" [style.color]="color" [style.text-shadow]="textShadowCss" style="z-index: 5; pointer-events: none" [innerHtml]="rubiedText"></div>
  </div>
  <div class="is-fit-full is-3d" style="backface-visibility: hidden" [ngClass]="{fall: altitude == 0}" [ngStyle]="{'transform': 'translateZ(' + (altitude * gridSize) + 'px)'}">
    <div class="is-fit-full is-3d chrome-smooth-image-trick" style="pointer-events: auto; position: absolute"
      [ngStyle]="{'opacity': opacity * (isGMMode && gameTableMask.isTransparentOnGMMode ? 0.6 : 1), 'background-color': imageFile.url.length < 1 || blendType > 0 ? bgcolor : null, '-webkit-mask': masksCss, mask: masksCss}"
      [ngClass]="{image: imageFile.url.length >= 1}">
      <img *ngIf="imageFile.url.length >= 1" class="is-fit-full is-3d chrome-smooth-image-trick" style="pointer-events: none; position: absolute;" [style.mix-blend-mode]="blendType == 1 ? null : 'hard-light'" [src]="imageFile.url | safe: 'resourceUrl'">
    </div>
    <div class="is-fit-full is-3d scratching-area border">
      <ng-container *ngIf="isScratching">
        <div *ngFor="let gridInfo of scratchingGridInfos; trackBy: identify"
          style="position: absolute; pointer-events: none; display: flex; justify-content: center; align-items: center"
          [style.width]="gridSize + 'px'"
          [style.height]="gridSize + 'px'"
          [style.left]="(gridInfo.x * gridSize) + 'px'"
          [style.top]="(gridInfo.y * gridSize) + 'px'"
        >
        <div style="width: calc(100% - 20px); height: calc(100% - 20px)" class="scratching-mark"
           [ngClass]="{ scratch: gridInfo.state == 1, restore: gridInfo.state == 2 }"></div>
        </div>
      </ng-container>
    </div>
  </div>
  <div *ngIf="!isScratching" class="lock-icon is-center is-3d" style="pointer-events: none; z-index: 10" [ngClass]="{fall: altitude == 0}" [ngStyle]="{'transform': 'translateZ(' + (altitude * gridSize) + 'px)'}">
    <i class="material-icons is-3d" style="pointer-events: none; backface-visibility: hidden">{{ isLock ? 'lock' : 'open_with' }}</i>
  </div>
  <div *ngIf="isScratching" class="scratching-icon is-center is-3d" style="pointer-events: none; z-index: 10" [ngClass]="{fall: altitude == 0, mine: gameTableMask.isMine}" [ngStyle]="{'transform': 'translateZ(' + (altitude * gridSize) + 'px)'}">
    <i class="material-icons is-3d" style="pointer-events: none; backface-visibility: hidden">draw</i>
  </div>
  <div class="is-3d" *ngIf="isAltitudeIndicate && math.abs(gameTableMaskAltitude) >= 0.5"
    style="display: flex; align-items: center; border-left: 2px dashed blanchedalmond; transform-origin: top left; pointer-events: none"
    [style.height.px]="math.abs(gameTableMaskAltitude * gridSize)"
    [ngStyle]="{transform: 'translateX(' + (width * gridSize / 2) + 'px) translateY(' + (-height * gridSize / 2) + 'px) rotateX(-90deg) translateY(' + (altitude > 0 ? -altitude * gridSize : 0) + 'px) rotateY(' + (viewRotateZ) + 'deg)'}">
    <div class="is-3d" style="pointer-events: none">
      <span class="altitude-indicator is-3d" style="position: absolute; pointer-events: none">{{ math.abs(gameTableMaskAltitude) }}</span>
      <span class="altitude-indicator is-3d" style="position: absolute; pointer-events: none; transform: rotateY(-180deg)">{{ gameTableMaskAltitude }}</span>
    </div>
  </div>
</div>